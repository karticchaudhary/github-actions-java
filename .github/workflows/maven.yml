# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-java-with-maven

# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

name: Java CICD with Maven

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    # This will run when a branch deployment that starts with 'pr-' succeeds. This should match the format of your instance parameter.
    name: TEST
    runs-on: ubuntu-latest
    steps:

      - name: Install xmllint
        run: sudo apt-get install -y libxml2-utils

      - name: Run health check for PPS !
        run: |
          export STATUS=curl -sIXGET https://payment-plan-service-pr-63.rcp.us-west-2.orders.test.exp-aws.net/actuator/health
           if [  STATUS != 301 ]; then
            echo "this is HTTP Status 301"
           else
            echo "not 200"
            fi
#        uses: actions/github-script@v3

#      - name: Check Status
#        if: [ $STATUS !="200" ]
#        uses: actions/github-script@v3
#        with:
#          script: |
#            core.setFailed('Application not up!!')

#      - name: Run health check !
#        id: vars
#        run: |
#          http_status=`curl -s -I https://google.com`
#
#          echo $http_status
#
#          if [  contains( $http_status , '301') ]; then
#          	echo "this is HTTP Status 301"
#          else
#                  echo "not 200"
#          fi
#
#          - name: Run health check for PPS !
#            run: |
#              export STATUS=curl -sIXGET https://payment-plan-service-${{ github.event.deployment_status.environment }}.rcp.us-west-2.orders.test.exp-aws.net/actuator/health
#              echo "::set-env name=STATUS::$STATUS"
#            uses: actions/github-script@v3
#
#          - name: Check Status
#            if: [ $STATUS !="200" ]
#            uses: actions/github-script@v3
#            with:
#              script: |
#                core.setFailed('Application not up!!')